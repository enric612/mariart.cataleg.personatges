<!DOCTYPE html>
<html lang="ca">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo de Personajes MariArT</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script>
        // Configuració personalitzada per a Tailwind CSS
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'fons': '#F5EFE6',       // Un beix molt clar per al fons
                        'targeta': '#E8DFCA',    // Un to lleugerament més fosc per a targetes
                        'text-principal': '#785A48', // Marró fosc per al text principal
                        'text-secundari': '#A98F7A', // Marró més suau per a subtítols
                        'accent': '#B48369',       // Un to terracota per a botons i accents
                        'accent-hover': '#9C6F5A',  // Versió més fosca per a l'hover de l'accent
                    },
                    fontFamily: {
                        sans: ['"Segoe UI"', 'Tahoma', 'Geneva', 'Verdana', 'sans-serif'],
                    },
                    borderRadius: {
                        '2xl': '1rem',
                        '3xl': '1.5rem',
                    }
                }
            }
        }
    </script>

    <style type="text/tailwindcss">
        body {
            @apply bg-fons text-text-principal antialiased;
        }
        .fade-in {
            animation: fadeIn 0.6s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Estil per al contenidor de la imatge */
        .image-container {
            @apply relative w-full h-80;
        }
        .image-placeholder {
            @apply absolute inset-0 bg-targeta/50 animate-pulse; /* Placeholder visible durant la càrrega */
        }
    </style>
</head>

<body>


        <div id="root"></div>


    <script type="text/babel">
        // --- Botó flotant Instagram ---
        function InstagramButton() {
            return (
                <a
                    href="https://instagram.com/mariart_natural"
                    target="_blank"
                    rel="noopener noreferrer"
                    title="Segueix-nos a Instagram"
                    style={{
                        position: 'fixed',
                        right: '2rem',
                        bottom: '2rem',
                        zIndex: 100,
                        width: '64px',
                        height: '64px',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        boxShadow: '0 4px 16px rgba(0,0,0,0.15)',
                        background: 'transparent',
                        borderRadius: '16px',
                        transition: 'transform 0.2s',
                    }}
                    onMouseOver={e => e.currentTarget.style.transform = 'scale(1.12)'}
                    onMouseOut={e => e.currentTarget.style.transform = 'scale(1)'}
                >
                    <img src="/imatges/instagram.webp" alt="Instagram" style={{ width: '48px', height: '48px', objectFit: 'contain' }} />
                </a>
            );
        }

        function WhatsappButton() {
            return (
                <a
                    href="https://wa.me/34657626290"
                    target="_blank"
                    rel="noopener noreferrer"
                    title="Contacta per WhatsApp"
                    style={{
                        position: 'fixed',
                        right: '2rem',
                        bottom: '8.5rem',
                        zIndex: 100,
                        width: '64px',
                        height: '64px',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        boxShadow: '0 4px 16px rgba(0,0,0,0.15)',
                        background: 'transparent',
                        borderRadius: '16px',
                        transition: 'transform 0.2s',
                    }}
                    onMouseOver={e => e.currentTarget.style.transform = 'scale(1.12)'}
                    onMouseOut={e => e.currentTarget.style.transform = 'scale(1)'}
                >
                    <img src="/imatges/whatsapp.webp" alt="WhatsApp" style={{ width: '48px', height: '48px', objectFit: 'contain' }} />
                </a>
            );
        }
        const { useState, useEffect } = React;
        // --- Component Auxiliar per a Càrrega Lazy amb Placeholder ---
        function LazyImage({ src, alt, className, loading }) {
            const [loaded, setLoaded] = useState(false);

            return (
                <div className="image-container">
                    {/* El Placeholder es mostra mentre la imatge no ha acabat de carregar */}
                    {!loaded && (
                        <div className="image-placeholder"></div>
                    )}

                    <img
                        src={src}
                        alt={alt}
                        className={`${className} ${loaded ? 'opacity-100' : 'opacity-0'} transition-opacity duration-700`}
                        loading={loading}
                        onLoad={() => setLoaded(true)}
                        style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: '100%' }}
                    />
                </div>
            );
        }

        // ----------------------------------------------------------------------
        // --- Component de la Vista Detallada (NIVELL 3) - AMB SUPORT DE VÍDEO ---
        // ----------------------------------------------------------------------
        function VistaDetall({ producte, onTorna }) {
            // Si hi ha videoUrl, el recurs actiu inicial és l'URL del vídeo, sinó és la primera imatge
            const initialSource = producte.videoUrl || producte.imatges[0];
            const [imatgeActiva, setImatgeActiva] = useState(initialSource);
            useEffect(() => { document.title = producte.nom; }, [producte]);

            // Comprova si el recurs actual és un vídeo (utilitzat per la renderització condicional)
            const isVideoActive = producte.videoUrl && imatgeActiva === producte.videoUrl;

            return (
                <div className="container mx-auto px-4 py-10 fade-in">
                    <header className="flex flex-col sm:flex-row justify-between items-center mb-8 gap-4">
                        <h1 className="text-4xl md:text-5xl font-bold text-text-principal text-center sm:text-left">{producte.nom}</h1>
                        <button onClick={onTorna} className="flex items-center gap-2 bg-accent text-white font-bold py-3 px-6 rounded-2xl hover:bg-accent-hover transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-1">
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clipRule="evenodd" /></svg>
                            Volver a {producte.categoriaNom}
                        </button>
                    </header>

                    <div className="bg-white p-4 sm:p-6 rounded-3xl shadow-lg mb-8">

                        {isVideoActive ? (
                            // CAS 1: MOSTRAR VÍDEO OPTIMITZAT (MP4/WebM)
                            <video
                                key={producte.videoUrl} // Utilitzem key per re-renderitzar quan canvia la font
                                className="w-full max-h-[70vh] object-contain rounded-2xl mx-auto"
                                autoPlay
                                loop
                                muted // Obligatori per a l'autoplay a molts navegadors
                                playsInline // Recomanat per a mòbils
                                poster={producte.imatges[0]} // WebP estàtic per a la previsualització
                                loading="eager"
                            >
                                <source src={producte.videoUrl} type="video/webm" />
                                {/* Fallback a imatge estàtica per a navegadors sense suport o error */}
                                <img src={producte.imatges[0]} alt={producte.nom} />
                            </video>
                        ) : (
                            // CAS 2: MOSTRAR IMATGE ESTÀTICA (WebP)
                            <img
                                src={imatgeActiva}
                                alt={`Imatge principal de ${producte.nom}`}
                                className="w-full max-h-[70vh] object-contain rounded-2xl mx-auto"
                                loading="eager"
                            />
                        )}
                    </div>

                    <div className="flex gap-4 justify-center flex-wrap">

                        {/* BOTÓ ADDICIONAL PER SELECCIONAR EL VÍDEO (si existeix) */}
                        {producte.videoUrl && (
                            <div
                                key="video-btn"
                                className={`w-24 h-24 flex items-center justify-center bg-targeta rounded-2xl cursor-pointer border-4 transition-all duration-300 hover:scale-105 hover:shadow-md ${producte.videoUrl === imatgeActiva ? 'border-accent shadow-lg' : 'border-transparent'}`}
                                onClick={() => setImatgeActiva(producte.videoUrl)}
                                title="Mostrar animación"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8 text-text-principal" viewBox="0 0 20 20" fill="currentColor">
                                    <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clipRule="evenodd" />
                                </svg>
                            </div>
                        )}

                        {/* MINIATURES D'IMATGES ESTÀTIQUES */}
                        {producte.imatges.map((imgSrc, index) => (
                            <img
                                key={index}
                                src={imgSrc}
                                alt={`Miniatura ${index + 1}`}
                                className={`w-24 h-24 object-cover rounded-2xl cursor-pointer border-4 transition-all duration-300 hover:scale-105 hover:shadow-md ${imgSrc === imatgeActiva ? 'border-accent shadow-lg' : 'border-transparent'}`}
                                onClick={() => setImatgeActiva(imgSrc)}
                                loading="eager" // Es carreguen eager, ja que estem a la vista detallada
                            />
                        ))}
                    </div>
                </div>
            );
        }

        // ----------------------------------------------------------------------
        // --- Component del Llistat de Productes (NIVELL 2) ---
        // ----------------------------------------------------------------------
        function LlistatProductesPerCategoria({ categoria, onProducteClick, onTorna }) {
            useEffect(() => {
                document.title = `Catálogo - ${categoria.nom}`;
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }, [categoria]);

            const [showScrollBtn, setShowScrollBtn] = React.useState(false);
            React.useEffect(() => {
                const handleScroll = () => {
                    setShowScrollBtn(window.scrollY > 50);
                };
                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            return (
                <main className="fade-in">
                    <header className="text-center py-8 px-4">
                        <h1 className="text-5xl md:text-6xl font-extrabold text-text-principal">{categoria.nom}</h1>
                        <p className="text-xl text-text-secundari mt-2 max-w-2xl mx-auto">Todos los personajes de nuestra colección de {categoria.nom}.</p>
                        <button onClick={onTorna} className="mt-4 flex items-center gap-1 mx-auto text-accent hover:text-accent-hover font-medium transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clipRule="evenodd" /></svg>
                            Volver a categorías
                        </button>
                        {showScrollBtn && (
                            <button
                                className="mt-6 px-6 py-3 bg-accent text-white font-bold rounded-2xl shadow-md hover:bg-accent-hover transition-all duration-300"
                                onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })}
                                title="Subir arriba"
                            >
                                ⬆ Subir arriba
                            </button>
                        )}
                    </header>
                    {showScrollBtn && (
                        <button
                            style={{ position: 'fixed', right: '2rem', bottom: '2rem', zIndex: 50 }}
                            className="px-6 py-3 bg-accent text-white font-bold rounded-2xl shadow-md hover:bg-accent-hover transition-all duration-300"
                            onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })}
                            title="Subir arriba"
                        >
                            ⬆ Subir arriba
                        </button>
                    )}
                    <div className="container mx-auto px-4 sm:px-8">
                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                            {categoria.productes.map(producte => (
                                <div key={producte.nom} className="bg-white rounded-3xl overflow-hidden shadow-lg cursor-pointer group transition-all duration-300 hover:shadow-2xl hover:-translate-y-2" onClick={() => onProducteClick({ ...producte, categoriaNom: categoria.nom })}>
                                    <div className="overflow-hidden">
                                        {/* Ús del component LazyImage amb loading="lazy" */}
                                        <LazyImage
                                            src={producte.imatges[0]}
                                            alt={producte.nom}
                                            className="w-full h-80 object-cover transition-transform duration-500 group-hover:scale-110"
                                            loading="lazy"
                                        />
                                    </div>
                                    <div className="p-6 text-center">
                                        <h3 className="text-2xl font-bold text-text-principal">{producte.nom}</h3>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </main>
            );
        }

        // ----------------------------------------------------------------------
        // --- Component del Llistat de Categories (NIVELL 1) ---
        // ----------------------------------------------------------------------
        function LlistatCategories({ categories, onCategoriaClick }) {
            useEffect(() => { document.title = "Catálogo de Personajes MariArT"; }, []);


            const [showScrollBtn, setShowScrollBtn] = React.useState(false);
            React.useEffect(() => {
                const handleScroll = () => {
                    setShowScrollBtn(window.scrollY > 50);
                };
                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            return (
                <main className="fade-in">
                    <header className="text-center py-12 px-4">
                        <h1 className="text-5xl md:text-6xl font-extrabold text-text-principal">Catálogo de personajes de MariArT</h1>
                        <p className="text-xl text-text-secundari mt-4 max-w-2xl mx-auto">Selecciona una categoria para explorar nuestros diseños.</p>
                        {showScrollBtn && (
                            <button
                                className="mt-6 px-6 py-3 bg-accent text-white font-bold rounded-2xl shadow-md hover:bg-accent-hover transition-all duration-300"
                                onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })}
                                title="Subir arriba"
                            >
                                ⬆ Subir arriba
                            </button>
                        )}
                    </header>
                    {showScrollBtn && (
                        <button
                            style={{ position: 'fixed', right: '2rem', bottom: '2rem', zIndex: 50 }}
                            className="px-6 py-3 bg-accent text-white font-bold rounded-2xl shadow-md hover:bg-accent-hover transition-all duration-300"
                            onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })}
                            title="Subir arriba"
                        >
                            ⬆ Subir arriba
                        </button>
                    )}
                    <div className="container mx-auto px-4 sm:px-8">
                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                            {categories.map(categoria => (
                                <div key={categoria.nom} className="bg-white rounded-3xl overflow-hidden shadow-lg cursor-pointer group transition-all duration-300 hover:shadow-2xl hover:-translate-y-2" onClick={() => onCategoriaClick(categoria)}>
                                    <div className="overflow-hidden">
                                        {/* Ús del component LazyImage amb loading="lazy" */}
                                        <LazyImage
                                            src={categoria.productes[0]?.imatges[0] || '/imatges/placeholder.webp'}
                                            alt={`Categoria ${categoria.nom}`}
                                            className="w-full h-80 object-cover transition-transform duration-500 group-hover:scale-110"
                                            loading="lazy"
                                        />
                                    </div>
                                    <div className="p-6 text-center">
                                        <h3 className="text-2xl font-bold text-text-principal">{categoria.nom}</h3>
                                        <p className="text-text-secundari mt-1 text-sm">{categoria.productes.length} producto{categoria.productes.length > 1 ? "s" : ""}</p>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </main>
            );
        }


        // --- Component Principal de l'Aplicació ---
        function App() {
            // Estats de navegació: 'categories', 'productes', 'detall'
            const [vista, setVista] = useState('categories');
            const [categoriaSeleccionada, setCategoriaSeleccionada] = useState(null);
            const [producteSeleccionat, setProducteSeleccionat] = useState(null);
            const [categoryData, setCategoryData] = useState({ categories: [] });
            useEffect(() => {
                fetch('categories.json')
                    .then(res => res.json())
                    .then(data => setCategoryData(data));
            }, []);
            const categories = categoryData.categories;

            const handleCategoriaClick = (categoria) => {
                setCategoriaSeleccionada(categoria);
                setVista('productes');
            };

            const handleProducteClick = (producte) => {
                setProducteSeleccionat(producte);
                setVista('detall');
            };

            const handleTornaAlLlistatDeProductes = () => {
                setProducteSeleccionat(null);
                setVista('productes');
            };

            const handleTornaAlLlistatDeCategories = () => {
                setCategoriaSeleccionada(null);
                setProducteSeleccionat(null);
                setVista('categories');
            };

            let content;

            if (vista === 'detall' && producteSeleccionat) {
                // IMPORTANT: Passem també el nom de la categoria per al botó de "Tornar"
                content = <VistaDetall producte={producteSeleccionat} onTorna={handleTornaAlLlistatDeProductes} categoriaNom={categoriaSeleccionada.nom} />;
            } else if (vista === 'productes' && categoriaSeleccionada) {
                content = <LlistatProductesPerCategoria categoria={categoriaSeleccionada} onProducteClick={handleProducteClick} onTorna={handleTornaAlLlistatDeCategories} />;
            } else {
                content = <LlistatCategories categories={categories} onCategoriaClick={handleCategoriaClick} />;
            }

            return (
                <div>
                    {content}
                    <InstagramButton />
                    <WhatsappButton />
                    <footer className="text-center py-8 mt-10">
                        <p className="text-text-secundari">&copy; {new Date().getFullYear()} MariArT</p>
                    </footer>
                </div>
            );
        }

        // --- Renderitzar l'aplicació ---
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>